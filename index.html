<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spin The Slice | Cyberpunk Pizza Roulette</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Exo+2:wght@300;400;600;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Exo 2', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        :root {
            --neon-cyan: #00ffff;
            --neon-pink: #ff0080;
            --neon-purple: #8a2be2;
            --neon-green: #39ff14;
            --neon-orange: #ff6600;
            --cyber-dark: #0a0a0f;
            --cyber-darker: #050508;
            --cyber-purple: #1a0d2e;
            --glass-bg: rgba(10, 10, 30, 0.8);
            --glass-border: rgba(0, 255, 255, 0.3);
            --pizza-crust: #d4a574;
            --pizza-sauce: #8b0000;
            /* Darker sauce color */
            --pizza-cheese: #fff8dc;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background: var(--cyber-darker);
            color: white;
            position: relative;
            min-height: 200vh;
            /* Allow for scrolling */
            overflow-x: hidden;
            /* Prevent horizontal scroll */
        }

        /* Performance optimization class for scrolling */
        .is-scrolling * {
            animation-play-state: paused !important;
        }

        .is-scrolling .player-card {
            box-shadow: none !important;
            transition: none !important;
        }

        .is-scrolling .player-card:hover {
            transform: none !important;
        }

        .is-scrolling .text-shadow,
        .is-scrolling .player-name-input,
        .is-scrolling .beautiful-text {
            text-shadow: none !important;
        }

        /* Beautiful signature UI text styling */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        p,
        span,
        div,
        label,
        button,
        input,
        select,
        option {
            text-shadow:
                0 0 4px rgba(255, 255, 255, 0.4),
                0 0 8px rgba(0, 255, 255, 0.2);
        }

        /* Enhanced white text with signature beautiful styling */
        .beautiful-text,
        .leaderboard-name,
        .instructions li,
        .player-name-input,
        .daily-result-content {
            color: rgba(255, 255, 255, 0.95);
            text-shadow:
                0 0 6px rgba(255, 255, 255, 0.6),
                0 0 12px rgba(0, 255, 255, 0.3),
                0 0 18px rgba(255, 0, 128, 0.1);
            font-weight: 500;
        }

        /* Premium glow for interactive elements */
        .premium-glow {
            text-shadow:
                0 0 8px rgba(255, 255, 255, 0.8),
                0 0 16px rgba(0, 255, 255, 0.4),
                0 0 24px rgba(255, 0, 128, 0.2),
                0 0 32px rgba(57, 255, 20, 0.1);
        }

        /* Enhanced background that covers full document height */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--cyber-darker) 0%, var(--cyber-dark) 100%);
            pointer-events: none;
            z-index: -2;
        }

        @keyframes ambientGlow {
            0% {
                opacity: 0.3;
            }

            100% {
                opacity: 0.7;
            }
        }

        .cyber-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 200vh;
            /* Cover full scrollable area */
            background:
                linear-gradient(rgba(0, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.05) 1px, transparent 1px),
                linear-gradient(45deg, rgba(255, 0, 128, 0.02) 1px, transparent 1px),
                linear-gradient(-45deg, rgba(57, 255, 20, 0.02) 1px, transparent 1px);
            background-size: 60px 60px, 60px 60px, 30px 30px, 30px 30px;
            pointer-events: none;
            z-index: -1;
            animation: gridPulse 4s ease-in-out infinite;
        }

        @keyframes gridPulse {

            0%,
            100% {
                opacity: 0.3;
            }

            50% {
                opacity: 0.6;
            }
        }

        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 200vh;
            /* Cover full scrollable area */
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--neon-cyan);
            border-radius: 50%;
            box-shadow: 0 0 10px currentColor;
            animation: float 15s linear infinite;
        }

        .particle:nth-child(2n) {
            background: var(--neon-pink);
            animation-duration: 20s;
        }

        .particle:nth-child(3n) {
            background: var(--neon-green);
            animation-duration: 18s;
        }

        .particle:nth-child(4n) {
            background: var(--neon-purple);
            animation-duration: 22s;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }

            5% {
                opacity: 1;
            }

            95% {
                opacity: 1;
            }

            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Main container with sections */
        .main-container {
            position: relative;
            z-index: 2;
        }

        /* Stunning floating navigation with signature UI style */
        .navbar {
            position: fixed;
            top: 20px;
            right: 30px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, rgba(10, 10, 30, 0.95), rgba(26, 13, 46, 0.9));
            backdrop-filter: blur(25px);
            border-radius: 50px;
            padding: 8px;
            border: 1px solid rgba(0, 255, 255, 0.3);
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.3),
                0 0 40px rgba(0, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .navbar-nav {
            display: flex;
            align-items: center;
            gap: 4px;
            margin: 0;
            padding: 0;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-family: 'Orbitron', monospace;
            font-weight: 600;
            font-size: 0.9rem;
            padding: 12px 18px;
            border-radius: 25px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 6px;
            background: transparent;
            position: relative;
            overflow: hidden;
            white-space: nowrap;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 128, 0.1));
            border-radius: 25px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-link:hover::before {
            opacity: 1;
        }

        .nav-link:hover {
            color: var(--neon-cyan);
            text-shadow:
                0 0 8px currentColor,
                0 0 16px rgba(0, 255, 255, 0.4);
            transform: translateY(-1px);
        }

        .nav-link.active {
            color: var(--neon-pink);
            background: rgba(255, 0, 128, 0.1);
            text-shadow:
                0 0 8px currentColor,
                0 0 16px rgba(255, 0, 128, 0.4);
        }

        .nav-link.active::before {
            opacity: 1;
            background: linear-gradient(135deg, rgba(255, 0, 128, 0.15), rgba(138, 43, 226, 0.1));
        }

        .navbar-toggle {
            display: none;
            background: none;
            border: 2px solid var(--neon-cyan);
            color: var(--neon-cyan);
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Responsive adjustments for mobile */
        @media (max-width: 768px) {
            .main-title {
                font-size: 2.5rem;
                top: 40px;
                letter-spacing: 2px;
            }

            .header-section {
                padding: 100px 20px 20px;
            }

            .game-area {
                margin-top: 10px;
                padding: 15px;
            }

            .wheel-container {
                width: min(70vh, 600px, 90vw);
                height: min(70vh, 600px, 90vw);
            }

            .spin-button {
                bottom: -13px;
                width: 120px;
                height: 120px;
                font-size: 1.1rem;
            }

            .navbar {
                top: 15px;
                right: 15px;
                padding: 6px;
            }

            .nav-link {
                padding: 10px 14px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .main-title {
                font-size: 2rem;
                top: 30px;
            }

            .header-section {
                padding: 80px 15px 15px;
            }

            .wheel-container {
                width: min(65vh, 500px, 95vw);
                height: min(65vh, 500px, 95vw);
            }

            .spin-button {
                bottom: -10px;
                width: 100px;
                height: 100px;
                font-size: 1rem;
            }
        }

        /* Main title back at the top center with amazing animation */
        .main-title {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Orbitron', monospace;
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(45deg, var(--neon-cyan), var(--neon-pink), var(--neon-purple), var(--neon-green));
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow:
                0 0 20px rgba(0, 255, 255, 0.5),
                0 0 40px rgba(255, 0, 128, 0.3),
                0 0 60px rgba(138, 43, 226, 0.2);
            letter-spacing: 4px;
            animation: titleGlow 3s ease-in-out infinite, gradientShift 6s ease-in-out infinite;
            position: relative;
            text-align: center;
            z-index: 1001;
        }

        .main-title::before {
            content: 'SPIN THE SLICE';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.4), transparent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: scanline 3s linear infinite;
            z-index: 1002;
        }

        /* Header section - clean and centered */
        .header-section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            padding: 140px 20px 20px;
        }

        .title::before {
            content: 'SPIN THE SLICE';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(45deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: scanline 2s linear infinite;
        }

        @keyframes titleGlow {

            0%,
            100% {
                text-shadow:
                    0 0 20px rgba(0, 255, 255, 0.8),
                    0 0 40px rgba(255, 0, 128, 0.4),
                    0 0 60px rgba(138, 43, 226, 0.2);
            }

            50% {
                text-shadow:
                    0 0 30px rgba(255, 0, 128, 0.8),
                    0 0 50px rgba(0, 255, 255, 0.4),
                    0 0 70px rgba(57, 255, 20, 0.3);
            }
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        @keyframes scanline {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .subtitle {
            display: none;
            /* Hide the subtitle in header */
        }

        @keyframes subtitlePulse {

            0%,
            100% {
                opacity: 0.7;
            }

            50% {
                opacity: 1;
            }
        }

        /* Game area - positioned below title with proper spacing */
        .game-area {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            margin-top: 10px;
        }

        .wheel-container {
            position: relative;
            width: min(75vh, 750px, 85vw);
            height: min(75vh, 750px, 85vw);
            max-width: 750px;
            max-height: 750px;
        }

        .wheel-frame {
            position: absolute;
            top: -20px;
            left: -20px;
            right: -20px;
            bottom: -20px;
            border: 3px solid var(--neon-cyan);
            border-radius: 50%;
            background:
                conic-gradient(from 0deg,
                    var(--neon-cyan) 0deg,
                    var(--neon-pink) 90deg,
                    var(--neon-purple) 180deg,
                    var(--neon-green) 270deg,
                    var(--neon-cyan) 360deg);
            padding: 3px;
            animation: frameRotate 20s linear infinite, framePulse 3s ease-in-out infinite;
            box-shadow:
                0 0 50px rgba(0, 255, 255, 0.5),
                inset 0 0 50px rgba(0, 255, 255, 0.2);
        }

        @keyframes frameRotate {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes framePulse {

            0%,
            100% {
                box-shadow: 0 0 50px rgba(0, 255, 255, 0.5), inset 0 0 50px rgba(0, 255, 255, 0.2);
            }

            50% {
                box-shadow: 0 0 80px rgba(255, 0, 128, 0.7), inset 0 0 80px rgba(255, 0, 128, 0.3);
            }
        }

        #pizzaWheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            cursor: grab;
            transition: transform 0.2s ease;
            box-shadow:
                0 0 100px rgba(255, 0, 128, 0.4),
                0 0 200px rgba(0, 255, 255, 0.2),
                inset 0 0 100px rgba(0, 0, 0, 0.8);
            z-index: 5;
        }

        #pizzaWheel:active {
            cursor: grabbing;
        }





        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: min(90px, 14%);
            height: min(90px, 14%);
            background:
                radial-gradient(circle at 20% 20%, rgba(0, 255, 255, 0.9) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(255, 0, 128, 0.7) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, var(--cyber-dark) 30%, var(--cyber-purple) 70%),
                linear-gradient(45deg, rgba(0, 255, 255, 0.1), rgba(255, 0, 128, 0.1));
            border-radius: 50%;
            z-index: 15;
            border: 3px solid var(--neon-cyan);
            box-shadow:
                0 0 60px rgba(0, 255, 255, 1),
                0 0 120px rgba(255, 0, 128, 0.8),
                0 0 180px rgba(0, 255, 255, 0.4),
                inset 0 0 30px rgba(255, 255, 255, 0.4),
                inset 0 0 60px rgba(0, 255, 255, 0.2);
            animation:
                centerCyberPulse 2s ease-in-out infinite,
                centerIdleGlow 4s ease-in-out infinite,
                centerNeonFlicker 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .wheel-center::before {
            content: '';
            position: absolute;
            top: -12px;
            left: -12px;
            right: -12px;
            bottom: -12px;
            border-radius: 50%;
            background:
                conic-gradient(from 0deg,
                    rgba(0, 255, 255, 0.8) 0deg,
                    rgba(255, 0, 128, 0.6) 60deg,
                    rgba(0, 255, 255, 0.8) 120deg,
                    rgba(138, 43, 226, 0.4) 180deg,
                    rgba(0, 255, 255, 0.8) 240deg,
                    rgba(255, 0, 128, 0.6) 300deg,
                    rgba(0, 255, 255, 0.8) 360deg);
            z-index: -1;
            animation: centerRingRotate 6s linear infinite;
            opacity: 0.9;
            filter: blur(2px);
        }

        .wheel-center::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70%;
            height: 70%;
            border-radius: 50%;
            background:
                radial-gradient(circle at 30% 30%, rgba(0, 255, 255, 1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255, 0, 128, 0.8) 0%, transparent 50%),
                radial-gradient(circle, rgba(255, 255, 255, 0.6) 0%, rgba(0, 255, 255, 0.3) 60%, transparent 100%);
            animation: centerCoreGlow 2.5s ease-in-out infinite alternate;
            box-shadow:
                0 0 20px rgba(0, 255, 255, 0.8),
                inset 0 0 15px rgba(255, 255, 255, 0.4);
        }

        @keyframes centerCyberPulse {

            0%,
            100% {
                box-shadow:
                    0 0 60px rgba(0, 255, 255, 1),
                    0 0 120px rgba(255, 0, 128, 0.8),
                    0 0 180px rgba(0, 255, 255, 0.4),
                    inset 0 0 30px rgba(255, 255, 255, 0.4),
                    inset 0 0 60px rgba(0, 255, 255, 0.2);
            }

            50% {
                box-shadow:
                    0 0 80px rgba(0, 255, 255, 1.2),
                    0 0 160px rgba(255, 0, 128, 1),
                    0 0 240px rgba(0, 255, 255, 0.6),
                    inset 0 0 40px rgba(255, 255, 255, 0.6),
                    inset 0 0 80px rgba(255, 0, 128, 0.3);
            }
        }

        @keyframes centerNeonFlicker {

            0%,
            100% {
                border-color: var(--neon-cyan);
                filter: brightness(1);
            }

            25% {
                border-color: rgba(0, 255, 255, 0.8);
                filter: brightness(1.2);
            }

            50% {
                border-color: var(--neon-pink);
                filter: brightness(0.9);
            }

            75% {
                border-color: rgba(255, 0, 128, 0.9);
                filter: brightness(1.1);
            }
        }

        @keyframes centerIdleGlow {

            0%,
            100% {
                filter: brightness(1) saturate(1);
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                filter: brightness(1.3) saturate(1.2);
                transform: translate(-50%, -50%) scale(1.05);
            }
        }

        @keyframes centerRingRotate {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes centerCoreGlow {
            0% {
                opacity: 0.3;
                transform: translate(-50%, -50%) scale(0.8);
            }

            100% {
                opacity: 0.8;
                transform: translate(-50%, -50%) scale(1.2);
            }
        }

        .pointer {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 100px;
            background:
                linear-gradient(45deg,
                    var(--neon-pink) 0%,
                    var(--neon-cyan) 50%,
                    var(--neon-pink) 100%);
            clip-path: polygon(50% 0%, 20% 80%, 50% 100%, 80% 80%);
            z-index: 25;
            box-shadow:
                0 0 30px rgba(255, 0, 128, 0.9),
                0 0 60px rgba(0, 255, 255, 0.6);
            animation: pointerPulse 1.5s ease-in-out infinite;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes pointerPulse {

            0%,
            100% {
                box-shadow:
                    0 0 30px rgba(255, 0, 128, 0.9),
                    0 0 60px rgba(0, 255, 255, 0.6);
                transform: translateX(-50%) scale(1);
            }

            50% {
                box-shadow:
                    0 0 50px rgba(0, 255, 255, 1),
                    0 0 100px rgba(255, 0, 128, 0.8);
                transform: translateX(-50%) scale(1.1);
            }
        }

        .cheese-pull {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 12;
            opacity: 0;
        }

        .cheese-pull.active {
            animation: cheesePull 2s ease-out;
        }

        @keyframes cheesePull {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }

            30% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }

            70% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }

        .spin-button {
            position: absolute;
            bottom: -22px;
            left: 50%;
            transform: translateX(-50%);
            background:
                radial-gradient(circle at 30% 30%, rgba(0, 255, 255, 0.3) 0%, transparent 60%),
                radial-gradient(circle at 70% 70%, rgba(255, 0, 128, 0.2) 0%, transparent 60%),
                linear-gradient(135deg, var(--cyber-dark), var(--cyber-purple), var(--cyber-dark));
            background-size: 200% 200%;
            border: 4px solid var(--neon-cyan);
            border-radius: 50%;
            width: 140px;
            height: 140px;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 1.3rem;
            font-weight: 900;
            color: white;
            text-shadow:
                0 0 8px rgba(255, 255, 255, 1),
                0 0 16px rgba(0, 255, 255, 0.8),
                0 0 24px rgba(255, 0, 128, 0.6),
                0 0 32px rgba(57, 255, 20, 0.4);
            box-shadow:
                0 0 40px rgba(0, 255, 255, 0.6),
                0 0 80px rgba(255, 0, 128, 0.4),
                inset 0 0 30px rgba(255, 255, 255, 0.2),
                inset 0 0 60px rgba(0, 255, 255, 0.1);
            animation:
                spinButtonMegaPulse 2s ease-in-out infinite,
                spinButtonGradientShift 6s ease-in-out infinite;
            z-index: 30;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 5px;
            position: relative;
            overflow: hidden;
        }

        .spin-button::before {
            content: '';
            position: absolute;
            top: -6px;
            left: -6px;
            right: -6px;
            bottom: -6px;
            border-radius: 50%;
            background: linear-gradient(45deg,
                    rgba(0, 255, 255, 0.4) 0%,
                    rgba(255, 0, 128, 0.3) 50%,
                    rgba(0, 255, 255, 0.4) 100%);
            z-index: -1;
            animation: spinButtonBorderRotate 8s linear infinite;
        }

        .spin-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            border-radius: 50%;
            background: radial-gradient(circle,
                    rgba(255, 255, 255, 0.2) 0%,
                    rgba(0, 255, 255, 0.1) 30%,
                    transparent 70%);
            animation: spinButtonInnerGlow 2.5s ease-in-out infinite alternate;
            pointer-events: none;
        }

        .spin-button:hover {
            transform: translateX(-50%) scale(1.1);
            box-shadow:
                0 0 60px rgba(0, 255, 255, 0.8),
                0 0 120px rgba(255, 0, 128, 0.6),
                inset 0 0 40px rgba(255, 255, 255, 0.3);
        }

        .spin-button:active {
            transform: translateX(-50%) scale(0.95);
        }

        @keyframes spinButtonPulse {

            0%,
            100% {
                box-shadow:
                    0 0 40px rgba(0, 255, 255, 0.6),
                    0 0 80px rgba(255, 0, 128, 0.4),
                    inset 0 0 30px rgba(255, 255, 255, 0.2);
            }

            50% {
                box-shadow:
                    0 0 60px rgba(255, 0, 128, 0.8),
                    0 0 120px rgba(0, 255, 255, 0.6),
                    inset 0 0 40px rgba(255, 255, 255, 0.3);
            }
        }

        @keyframes spinButtonMegaPulse {

            0%,
            100% {
                box-shadow:
                    0 0 40px rgba(0, 255, 255, 0.6),
                    0 0 80px rgba(255, 0, 128, 0.4),
                    inset 0 0 30px rgba(255, 255, 255, 0.2),
                    inset 0 0 60px rgba(0, 255, 255, 0.1);
            }

            50% {
                box-shadow:
                    0 0 60px rgba(0, 255, 255, 0.8),
                    0 0 120px rgba(255, 0, 128, 0.6),
                    inset 0 0 40px rgba(255, 255, 255, 0.3),
                    inset 0 0 80px rgba(255, 0, 128, 0.15);
            }
        }

        @keyframes spinButtonGradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        @keyframes spinButtonRotate {
            0% {
                filter: hue-rotate(0deg);
            }

            100% {
                filter: hue-rotate(360deg);
            }
        }

        @keyframes spinButtonBorderRotate {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes spinButtonInnerGlow {
            0% {
                opacity: 0.3;
                transform: translate(-50%, -50%) scale(0.8);
            }

            100% {
                opacity: 0.8;
                transform: translate(-50%, -50%) scale(1.2);
            }
        }

        /* Instructions panel - accessible via navbar */
        .instructions {
            display: none;
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            width: 380px;
            background: var(--glass-bg);
            border: 2px solid var(--neon-purple);
            border-radius: 20px;
            padding: 25px 30px;
            backdrop-filter: blur(20px);
            box-shadow:
                0 0 40px rgba(138, 43, 226, 0.3),
                inset 0 0 40px rgba(138, 43, 226, 0.1);
            z-index: 150;
            max-height: 80vh;
            overflow-y: auto;
        }

        .instructions.active {
            display: block;
        }

        .instructions h3 {
            color: var(--neon-pink);
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            text-shadow:
                0 0 5px currentColor,
                0 0 10px currentColor,
                0 0 15px currentColor,
                0 0 20px rgba(255, 0, 128, 0.3);
        }

        .instructions ul {
            list-style: none;
            padding-left: 0;
        }

        .instructions li {
            margin-bottom: 15px;
            padding-left: 35px;
            position: relative;
            font-size: 1rem;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
        }

        .instructions li::before {
            content: "🍕";
            position: absolute;
            left: 0;
            top: 0;
            font-size: 1.3rem;
            filter: drop-shadow(0 0 5px var(--neon-orange));
            animation: bulletGlow 1.5s ease-in-out infinite alternate;
        }

        @keyframes bulletGlow {
            from {
                filter: drop-shadow(0 0 3px var(--neon-orange));
                opacity: 0.8;
            }

            to {
                filter: drop-shadow(0 0 10px var(--neon-orange));
                opacity: 1;
            }
        }

        .instructions li strong {
            font-weight: bold;
            color: var(--neon-cyan);
            text-shadow:
                0 0 5px currentColor,
                0 0 10px currentColor,
                0 0 15px rgba(0, 255, 255, 0.4);
            font-family: 'Orbitron', monospace;
        }

        /* Player dock - positioned lower on left side of wheel */
        .player-dock {
            position: fixed;
            left: -380px;
            top: 50%;
            transform: translateY(-50%);
            width: 380px;
            height: 55vh;
            background: var(--glass-bg);
            border: 2px solid var(--neon-cyan);
            border-left: none;
            border-radius: 0 25px 25px 0;
            backdrop-filter: blur(20px);
            box-shadow:
                0 0 40px rgba(0, 255, 255, 0.3),
                inset 0 0 40px rgba(0, 255, 255, 0.1);
            z-index: 100;
            transition: transform 0.3s ease-out;
            display: flex;
            flex-direction: column;
            will-change: transform;
            /* Hardware acceleration */
            transform: translateY(-50%) translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        .player-dock.expanded {
            transform: translateY(-50%) translateX(380px) translateZ(0);
        }

        .leaderboard-dock.expanded {
            transform: translateX(380px);
        }

        /* Leaderboard dock - positioned at bottom left to avoid overlap */
        .leaderboard-dock {
            position: fixed;
            left: -380px;
            bottom: 20px;
            width: 380px;
            height: 50vh;
            background: var(--glass-bg);
            border: 2px solid var(--neon-yellow);
            border-left: none;
            border-radius: 0 25px 25px 0;
            backdrop-filter: blur(20px);
            box-shadow:
                0 0 40px rgba(255, 255, 0, 0.3),
                inset 0 0 40px rgba(255, 255, 0, 0.1);
            z-index: 99;
            transition: transform 0.3s ease-out;
            display: flex;
            flex-direction: column;
            will-change: transform;
        }

        .leaderboard-toggle {
            position: absolute;
            right: -70px;
            top: 20px;
            background: linear-gradient(45deg, var(--neon-yellow), var(--neon-orange));
            border: 2px solid var(--neon-yellow);
            border-radius: 0 20px 20px 0;
            padding: 20px 25px 20px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 10px;
            font-size: 1rem;
            font-family: 'Orbitron', monospace;
            color: white;
            font-weight: 700;
            box-shadow:
                0 0 30px rgba(255, 255, 0, 0.5),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            animation: leaderboardButtonGlow 3s ease-in-out infinite;
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }

        .leaderboard-toggle:hover {
            right: -60px;
            box-shadow:
                0 0 50px rgba(255, 255, 0, 0.7),
                inset 0 0 50px rgba(255, 255, 255, 0.2);
            border-color: var(--neon-green);
        }

        @keyframes leaderboardButtonGlow {

            0%,
            100% {
                box-shadow: 0 0 25px rgba(255, 255, 0, 0.5), inset 0 0 25px rgba(255, 255, 255, 0.1);
            }

            50% {
                box-shadow: 0 0 35px rgba(255, 255, 0, 0.6), inset 0 0 35px rgba(255, 255, 255, 0.15);
            }
        }

        .leaderboard-panel {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--neon-yellow) transparent;
        }

        .leaderboard-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .leaderboard-grid::-webkit-scrollbar {
            width: 8px;
        }

        .leaderboard-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .leaderboard-grid::-webkit-scrollbar-thumb {
            background: var(--neon-yellow);
            border-radius: 4px;
        }

        .leaderboard-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--neon-yellow);
        }

        .leaderboard-header h3 {
            color: var(--neon-yellow);
            font-family: 'Orbitron', monospace;
            font-size: 1.4rem;
            margin-bottom: 10px;
            text-shadow:
                0 0 5px currentColor,
                0 0 10px currentColor,
                0 0 15px currentColor,
                0 0 20px rgba(255, 255, 0, 0.3);
        }

        .leaderboard-stats {
            color: var(--neon-cyan);
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            text-shadow:
                0 0 5px currentColor,
                0 0 10px rgba(0, 255, 255, 0.4);
        }

        .leaderboard-entry {
            background: rgba(10, 10, 30, 0.9);
            border: 2px solid var(--neon-yellow);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            box-shadow:
                0 0 20px rgba(255, 255, 0, 0.2),
                inset 0 0 20px rgba(255, 255, 0, 0.05);
        }

        .leaderboard-entry:hover {
            border-color: var(--neon-pink);
            box-shadow:
                0 0 30px rgba(255, 0, 128, 0.3),
                inset 0 0 30px rgba(255, 0, 128, 0.1);
            transform: translateY(-2px);
        }

        .leaderboard-rank {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            font-weight: 900;
            min-width: 30px;
            text-align: center;
            color: var(--neon-yellow);
            text-shadow:
                0 0 5px currentColor,
                0 0 10px rgba(255, 255, 0, 0.4);
        }

        .leaderboard-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--neon-yellow);
            overflow: hidden;
            flex-shrink: 0;
        }

        .leaderboard-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .leaderboard-name {
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            color: white;
            flex: 1;
            text-shadow:
                0 0 5px rgba(255, 255, 255, 0.5),
                0 0 10px rgba(0, 255, 255, 0.3);
        }

        .leaderboard-wins {
            background: rgba(255, 255, 0, 0.1);
            border: 1px solid var(--neon-yellow);
            border-radius: 20px;
            padding: 5px 15px;
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            color: var(--neon-yellow);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .leaderboard-wins i {
            font-size: 0.8rem;
        }

        .players-toggle {
            position: absolute;
            right: -70px;
            top: 20px;
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-purple));
            border: 2px solid var(--neon-cyan);
            border-radius: 0 20px 20px 0;
            padding: 20px 25px 20px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 10px;
            font-size: 1rem;
            font-family: 'Orbitron', monospace;
            color: white;
            font-weight: 700;
            box-shadow:
                0 0 30px rgba(255, 0, 128, 0.5),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            animation: playersButtonGlow 3s ease-in-out infinite;
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }

        .players-toggle:hover {
            right: -60px;
            box-shadow:
                0 0 50px rgba(0, 255, 255, 0.7),
                inset 0 0 50px rgba(255, 255, 255, 0.2);
            border-color: var(--neon-green);
        }

        @keyframes playersButtonGlow {

            0%,
            100% {
                box-shadow: 0 0 25px rgba(255, 0, 128, 0.5), inset 0 0 25px rgba(255, 255, 255, 0.1);
            }

            50% {
                box-shadow: 0 0 35px rgba(0, 255, 255, 0.6), inset 0 0 35px rgba(255, 255, 255, 0.15);
            }
        }

        .players-panel {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--neon-cyan) transparent;
            /* Optimize scrolling */
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
            will-change: scroll-position;
        }

        .players-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            /* Optimize rendering */
            contain: layout style;
        }

        .players-grid::-webkit-scrollbar {
            width: 8px;
        }

        .players-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .players-grid::-webkit-scrollbar-thumb {
            background: var(--neon-cyan);
            border-radius: 4px;
        }

        .player-card {
            position: relative;
            background: rgba(10, 10, 30, 0.9);
            border: 2px solid var(--neon-green);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: border-color 0.2s ease, transform 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            min-height: 120px;
            /* Hardware acceleration */
            transform: translateZ(0);
            will-change: transform, border-color;
            backface-visibility: hidden;
        }

        .player-card:hover {
            border-color: var(--neon-pink);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
            transform: translateY(-2px) translateZ(0);
        }

        /* Simplified glow effect for performance */
        .player-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--neon-green), transparent);
            border-radius: 12px;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: -1;
            pointer-events: none;
        }

        .player-card:hover::before {
            opacity: 0.3;
        }

        .player-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--neon-cyan), var(--neon-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            flex-shrink: 0;
        }

        .player-name-input {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--neon-cyan);
            border-radius: 6px;
            color: white;
            font-size: 0.85rem;
            font-family: 'Orbitron', monospace;
            padding: 6px 10px;
            outline: none;
            transition: border-color 0.2s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
            flex: 1;
            min-width: 0;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            /* Hardware acceleration */
            transform: translateZ(0);
            will-change: border-color;
        }

        .player-name-input:focus {
            border-color: var(--neon-pink);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .prediction-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .prediction-select {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid var(--neon-purple);
            border-radius: 6px;
            color: white;
            font-size: 0.8rem;
            font-family: 'Orbitron', monospace;
            padding: 6px 10px;
            flex: 1;
            outline: none;
            cursor: pointer;
            transition: border-color 0.2s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
            min-width: 0;
            /* Hardware acceleration */
            transform: translateZ(0);
            will-change: border-color;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .prediction-select:focus {
            border-color: var(--neon-green);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Custom dropdown arrow for better performance */
        .prediction-select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg width='14' height='8' viewBox='0 0 14 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M1 1L7 7L13 1' stroke='%2300ffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 30px;
        }

        .random-dice {
            background: linear-gradient(45deg, var(--neon-orange), var(--neon-pink));
            color: white;
            border: 2px solid var(--neon-cyan);
            padding: 6px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow:
                0 0 15px rgba(255, 102, 0, 0.4),
                inset 0 0 15px rgba(255, 255, 255, 0.1);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .random-dice:hover {
            transform: rotate(180deg) scale(1.1);
            box-shadow:
                0 0 25px rgba(0, 255, 255, 0.6),
                inset 0 0 25px rgba(255, 255, 255, 0.2);
            border-color: var(--neon-green);
        }

        /* Daily result section - bigger and more aesthetic */
        .daily-result-section {
            position: absolute;
            bottom: 40px;
            left: 40px;
            width: 500px;
            z-index: 50;
        }

        .daily-result {
            width: 100%;
            background: 
                radial-gradient(ellipse at top left, rgba(255, 0, 128, 0.1) 0%, transparent 40%),
                radial-gradient(ellipse at bottom right, rgba(0, 255, 255, 0.1) 0%, transparent 40%),
                linear-gradient(135deg, rgba(10, 10, 30, 0.98) 0%, rgba(20, 10, 40, 0.95) 50%, rgba(10, 20, 50, 0.98) 100%);
            border: 3px solid transparent;
            border-radius: 25px;
            padding: 35px;
            backdrop-filter: blur(25px) saturate(150%);
            box-shadow:
                0 0 40px rgba(0, 255, 255, 0.4),
                0 0 80px rgba(255, 0, 128, 0.2),
                0 0 120px rgba(138, 43, 226, 0.1),
                inset 0 0 30px rgba(0, 255, 255, 0.05),
                inset 0 0 60px rgba(255, 0, 128, 0.03);
            text-align: center;
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
        }

        .daily-result::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: conic-gradient(
                from 0deg at 50% 50%,
                var(--neon-cyan) 0deg,
                var(--neon-pink) 60deg,
                var(--neon-purple) 120deg,
                var(--neon-green) 180deg,
                var(--neon-orange) 240deg,
                var(--neon-pink) 300deg,
                var(--neon-cyan) 360deg
            );
            border-radius: 25px;
            z-index: -2;
            animation: borderRotate 6s linear infinite;
            opacity: 0.8;
        }

        .daily-result::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 10px,
                    rgba(0, 255, 255, 0.02) 10px,
                    rgba(0, 255, 255, 0.02) 20px
                );
            border-radius: 22px;
            z-index: -1;
            animation: scanlines 8s linear infinite;
        }

        @keyframes borderRotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes scanlines {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 40px 40px;
            }
        }



        .daily-result-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.2rem;
            color: var(--neon-cyan);
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow:
                0 0 10px currentColor,
                0 0 20px currentColor,
                0 0 30px rgba(0, 255, 255, 0.5);
            font-weight: 400;
            opacity: 0.9;
            position: relative;
            display: inline-block;
        }

        .daily-result-title::before,
        .daily-result-title::after {
            content: '◆';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: var(--neon-pink);
            font-size: 0.8rem;
            animation: pulseIcon 2s ease-in-out infinite;
        }

        .daily-result-title::before {
            left: -25px;
        }

        .daily-result-title::after {
            right: -25px;
        }

        @keyframes pulseIcon {
            0%, 100% {
                opacity: 0.5;
                transform: translateY(-50%) scale(1);
            }
            50% {
                opacity: 1;
                transform: translateY(-50%) scale(1.2);
            }
        }

        .daily-result-content {
            font-size: 2.5rem;
            color: white;
            margin-bottom: 30px;
            font-family: 'Orbitron', monospace;
            font-weight: 900;
            background: linear-gradient(
                45deg,
                var(--neon-pink) 0%,
                var(--neon-cyan) 25%,
                var(--neon-green) 50%,
                var(--neon-purple) 75%,
                var(--neon-pink) 100%
            );
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientFlow 4s ease-in-out infinite;
            text-transform: uppercase;
            letter-spacing: 2px;
            line-height: 1.2;
            position: relative;
            display: inline-block;
            filter: drop-shadow(0 0 20px rgba(0, 255, 255, 0.5));
        }

        @keyframes gradientFlow {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        .daily-result-winners {
            font-size: 1rem;
            color: var(--neon-green);
            font-family: 'Orbitron', monospace;
            line-height: 1.6;
            margin-top: 20px;
            position: relative;
        }

        .daily-result-winners strong {
            color: var(--neon-yellow);
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 2px;
            display: block;
            margin-bottom: 15px;
            text-shadow:
                0 0 10px currentColor,
                0 0 20px rgba(255, 255, 0, 0.5);
        }

        .daily-result-winner-item {
            padding: 12px 24px;
            background: 
                linear-gradient(135deg, rgba(57, 255, 20, 0.1) 0%, rgba(0, 255, 255, 0.05) 100%);
            border: 2px solid transparent;
            border-radius: 30px;
            display: inline-block;
            margin: 8px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .daily-result-winner-item::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(
                45deg,
                var(--neon-green),
                var(--neon-cyan),
                var(--neon-green)
            );
            border-radius: 30px;
            z-index: -1;
            opacity: 0.8;
            animation: winnerBorderGlow 3s linear infinite;
        }

        .daily-result-winner-item::after {
            content: '🏆';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            animation: trophyBounce 2s ease-in-out infinite;
        }

        @keyframes winnerBorderGlow {
            0%, 100% {
                opacity: 0.6;
                filter: hue-rotate(0deg);
            }
            50% {
                opacity: 1;
                filter: hue-rotate(20deg);
            }
        }

        @keyframes trophyBounce {
            0%, 100% {
                transform: translateY(-50%) scale(1) rotate(0deg);
            }
            25% {
                transform: translateY(-50%) scale(1.1) rotate(-5deg);
            }
            75% {
                transform: translateY(-50%) scale(1.1) rotate(5deg);
            }
        }

        .daily-result-winner-item:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow:
                0 10px 30px rgba(57, 255, 20, 0.4),
                0 0 50px rgba(0, 255, 255, 0.3);
        }

        /* Scroll indicator */
        .scroll-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--neon-green);
            font-size: 2rem;
            animation: bounce 2s infinite;
            cursor: pointer;
            z-index: 10;
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateX(-50%) translateY(0);
            }

            40% {
                transform: translateX(-50%) translateY(-10px);
            }

            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        /* Result popup and other modals remain the same */
        .result-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(10, 10, 30, 0.95);
            border: 3px solid var(--neon-cyan);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            z-index: 200;
            box-shadow:
                0 0 80px rgba(0, 255, 255, 0.6),
                inset 0 0 40px rgba(0, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 600px;
            width: 90%;
        }

        .result-popup.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .result-title {
            font-size: 2.2rem;
            font-family: 'Orbitron', monospace;
            color: var(--neon-cyan);
            margin-bottom: 20px;
            font-weight: 900;
            text-shadow: 0 0 20px currentColor;
        }

        .result-content {
            font-size: 2.8rem;
            font-weight: 900;
            font-family: 'Orbitron', monospace;
            color: white;
            margin: 25px 0;
            text-shadow:
                0 0 20px rgba(255, 0, 128, 0.8),
                0 0 40px rgba(0, 255, 255, 0.6);
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: resultGlow 2s ease-in-out infinite;
        }

        @keyframes resultGlow {

            0%,
            100% {
                text-shadow:
                    0 0 20px rgba(255, 0, 128, 0.8),
                    0 0 40px rgba(0, 255, 255, 0.6);
            }

            50% {
                text-shadow:
                    0 0 30px rgba(0, 255, 255, 1),
                    0 0 60px rgba(255, 0, 128, 0.8);
            }
        }

        .celebration-button {
            background: linear-gradient(45deg, var(--neon-green), #00ffcc);
            color: var(--cyber-dark);
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 0 auto;
        }

        .celebration-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 0 50px rgba(0, 255, 136, 0.8);
        }

        .close-popup {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #a0a0c0;
            cursor: pointer;
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-popup:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 150;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 300;
        }

        .camera-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at center, rgba(138, 43, 226, 0.2) 0%, transparent 60%),
                radial-gradient(ellipse at top left, rgba(255, 0, 128, 0.15) 0%, transparent 40%),
                radial-gradient(ellipse at bottom right, rgba(0, 255, 255, 0.15) 0%, transparent 40%),
                rgba(0, 0, 0, 0.98);
            z-index: 1000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(30px);
        }

        .camera-content {
            background: 
                radial-gradient(ellipse at top left, rgba(255, 0, 128, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, rgba(10, 10, 30, 0.98) 0%, rgba(20, 10, 40, 0.95) 50%, rgba(10, 20, 50, 0.98) 100%);
            border: 3px solid transparent;
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            max-width: 900px;
            width: 90%;
            box-shadow:
                0 0 60px rgba(0, 255, 255, 0.5),
                0 0 120px rgba(255, 0, 128, 0.3),
                0 0 180px rgba(138, 43, 226, 0.2),
                inset 0 0 40px rgba(0, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
        }

        .camera-content::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: conic-gradient(
                from 0deg at 50% 50%,
                var(--neon-pink) 0deg,
                var(--neon-cyan) 90deg,
                var(--neon-purple) 180deg,
                var(--neon-green) 270deg,
                var(--neon-pink) 360deg
            );
            border-radius: 30px;
            z-index: -2;
            animation: borderRotate 8s linear infinite;
            opacity: 0.9;
        }

        .camera-title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(
                45deg,
                var(--neon-cyan) 0%,
                var(--neon-pink) 25%,
                var(--neon-green) 50%,
                var(--neon-purple) 75%,
                var(--neon-cyan) 100%
            );
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientFlow 3s ease-in-out infinite;
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 3px;
            filter: drop-shadow(0 0 30px rgba(0, 255, 255, 0.5));
        }

        #videoElement {
            width: 100%;
            max-width: 600px;
            height: 450px;
            object-fit: cover;
            border-radius: 20px;
            margin: 20px 0;
            border: 4px solid transparent;
            position: relative;
            background: linear-gradient(var(--cyber-dark), var(--cyber-dark)) padding-box,
                        linear-gradient(45deg, var(--neon-pink), var(--neon-cyan), var(--neon-purple)) border-box;
            box-shadow:
                0 0 40px rgba(255, 0, 128, 0.4),
                0 0 80px rgba(0, 255, 255, 0.2);
        }

        #capturedImage {
            width: 100%;
            max-width: 600px;
            height: 450px;
            object-fit: cover;
            border-radius: 20px;
            margin: 20px auto;
            border: 4px solid transparent;
            background: linear-gradient(var(--cyber-dark), var(--cyber-dark)) padding-box,
                        linear-gradient(45deg, var(--neon-green), var(--neon-cyan), var(--neon-pink)) border-box;
            display: none;
            box-shadow:
                0 0 50px rgba(57, 255, 20, 0.5),
                0 0 100px rgba(0, 255, 255, 0.3);
        }

        .camera-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .camera-button {
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-purple));
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1.1rem;
            font-family: 'Orbitron', monospace;
            transition: all 0.3s ease;
            box-shadow: 
                0 0 30px rgba(255, 0, 128, 0.6),
                0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
        }

        .camera-button::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--neon-cyan), var(--neon-pink), var(--neon-purple));
            border-radius: 50px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }

        .camera-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 0 40px rgba(255, 0, 128, 0.8),
                0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .camera-button:hover::before {
            opacity: 0.7;
        }

        .capture-button {
            background: linear-gradient(45deg, var(--neon-green), var(--neon-cyan));
            color: var(--cyber-dark);
            font-size: 1.3rem;
            padding: 20px 40px;
        }

        .capture-button:hover {
            box-shadow: 
                0 0 50px rgba(57, 255, 20, 0.8),
                0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .leaderboard-button {
            background: linear-gradient(45deg, var(--neon-yellow), var(--neon-orange));
            color: var(--cyber-dark);
        }

        .leaderboard-button:hover {
            box-shadow: 
                0 0 40px rgba(255, 255, 0, 0.8),
                0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .share-options {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .share-button {
            background: linear-gradient(45deg, var(--neon-cyan), #0080ff);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .share-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.7);
        }

        /* Footer tagline - moved to bottom right of scrollable area */
        .footer-tagline {
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            color: #66ff66;
            text-shadow: 0 0 6px rgba(102, 255, 102, 0.4);
            opacity: 0.7;
            z-index: 50;
            animation: taglinePulse 4s ease-in-out infinite;
        }

        @keyframes taglinePulse {

            0%,
            100% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }
        }

        /* Music Player Section */
        .music-section {
            position: absolute;
            bottom: 40px;
            right: 40px;
            width: 350px;
            z-index: 50;
            background: transparent;
            pointer-events: none;
        }

        .music-player-container {
            width: 100%;
            background: 
                linear-gradient(135deg, rgba(10, 10, 30, 0.95) 0%, rgba(26, 13, 46, 0.9) 100%);
            border: 2px solid rgba(0, 255, 255, 0.4);
            border-radius: 15px;
            padding: 15px;
            backdrop-filter: blur(20px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.6),
                0 0 20px rgba(0, 255, 255, 0.3);
            position: relative;
            pointer-events: all;
        }

        .music-player-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, 
                var(--neon-cyan), 
                var(--neon-pink), 
                var(--neon-green));
            border-radius: 20px;
            opacity: 0.4;
            z-index: -1;
        }

        .music-title {
            text-align: center;
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 12px;
            background: linear-gradient(
                45deg,
                var(--neon-pink) 0%,
                var(--neon-cyan) 33%,
                var(--neon-green) 66%,
                var(--neon-pink) 100%
            );
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientFlow 4s ease-in-out infinite;
            text-transform: uppercase;
            letter-spacing: 1px;
            filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.2));
        }

        .music-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .track-card {
            background: 
                rgba(10, 10, 30, 0.6);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 8px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            backdrop-filter: blur(8px);
        }

        .track-card::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(45deg, 
                var(--neon-cyan), 
                var(--neon-pink), 
                var(--neon-green));
            border-radius: 12px;
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s ease;
        }

        .track-card:hover::before {
            opacity: 0.3;
        }

        .track-card:hover {
            transform: translateY(-1px);
            box-shadow: 
                0 3px 15px rgba(0, 255, 255, 0.2),
                0 0 20px rgba(255, 0, 128, 0.1);
        }

        .track-card.playing {
            border: 1px solid var(--neon-green);
            box-shadow: 
                0 0 15px rgba(57, 255, 20, 0.3),
                0 0 25px rgba(0, 255, 255, 0.2);
        }

        .track-card.playing::before {
            background: linear-gradient(45deg, 
                var(--neon-green), 
                var(--neon-cyan), 
                var(--neon-green));
            opacity: 0.3;
        }

        .track-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .track-icon {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-pink));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .track-icon::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, transparent 30%, rgba(255, 255, 255, 0.1) 100%);
            animation: pulse 2s ease-in-out infinite;
        }

        .track-card.playing .track-icon {
            animation: spin 3s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .track-details {
            flex: 1;
            min-width: 0;
        }

        .track-name {
            font-family: 'Orbitron', monospace;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--neon-cyan);
            margin-bottom: 2px;
            text-shadow: 0 0 6px currentColor;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .track-artist {
            font-size: 0.75rem;
            color: var(--neon-pink);
            opacity: 0.8;
            text-shadow: 0 0 4px currentColor;
        }

        .track-controls {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .play-button {
            background: linear-gradient(135deg, var(--neon-green), var(--neon-cyan));
            color: var(--cyber-dark);
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Orbitron', monospace;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 10px rgba(57, 255, 20, 0.3);
        }

        .play-button:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 30px rgba(57, 255, 20, 0.6);
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-green), var(--neon-cyan));
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 8px currentColor;
        }

        .visualizer {
            display: flex;
            align-items: flex-end;
            gap: 1px;
            height: 18px;
            margin-top: 8px;
        }

        .visualizer-bar {
            flex: 1;
            background: linear-gradient(to top, var(--neon-cyan), var(--neon-pink));
            min-height: 2px;
            border-radius: 1px;
            transition: height 0.1s ease;
        }

        .track-card.playing .visualizer-bar {
            animation: dance 0.5s ease-in-out infinite;
        }

        .track-card.playing .visualizer-bar:nth-child(2n) {
            animation-delay: 0.1s;
        }

        .track-card.playing .visualizer-bar:nth-child(3n) {
            animation-delay: 0.2s;
        }

        @keyframes dance {
            0%, 100% { height: 5px; }
            50% { height: 100%; }
        }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .instructions {
                right: 10px;
                width: 300px;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 0 20px;
            }

            .navbar-nav {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: rgba(10, 10, 30, 0.98);
                flex-direction: column;
                padding: 20px;
                border-top: 2px solid var(--neon-cyan);
                gap: 15px;
            }

            .navbar-nav.active {
                display: flex;
            }

            .navbar-toggle {
                display: block;
            }

            .navbar-brand {
                font-size: 1.5rem;
            }

            .title {
                font-size: 3rem;
            }

            .wheel-container {
                width: min(60vh, 70vw);
                height: min(60vh, 70vw);
            }

            .instructions {
                display: none !important;
            }

            .leaderboard-dock {
                left: -320px;
                width: 320px;
                bottom: 10px;
                height: 45vh;
            }

            .leaderboard-toggle {
                right: -60px;
                padding: 15px 20px 15px 15px;
            }

            .main-title {
                font-size: 2.5rem;
                top: 60px;
            }

            .daily-result-section {
                width: 380px;
                bottom: 15px;
                left: 15px;
            }

            .navbar {
                top: 15px;
                right: 20px;
                gap: 6px;
                padding: 6px;
            }

            .navbar {
                top: 10px;
                right: 20px;
                gap: 10px;
            }

            .player-dock {
                width: 320px;
                left: -320px;
                top: 50%;
                height: 50vh;
            }

            .players-toggle {
                right: -60px;
                padding: 15px 20px 15px 15px;
            }

            .spin-button {
                width: 100px;
                height: 100px;
                font-size: 1rem;
                bottom: -40px;
            }

            .footer-tagline {
                position: relative;
                text-align: center;
                margin: 20px 0;
            }

            .music-section {
                bottom: 20px;
                right: 20px;
                width: 320px;
            }

            .result-content {
                font-size: 2.2rem;
            }

            .result-title {
                font-size: 1.8rem;
            }

            .daily-result-title {
                font-size: 2rem;
            }

            .daily-result-content {
                font-size: 1.4rem;
            }
        }

        @media (max-height: 600px) {
            .header-section {
                min-height: 120vh;
            }

            .title {
                font-size: 2.5rem;
                margin-bottom: 10px;
            }

            .subtitle {
                font-size: 1rem;
                margin-bottom: 20px;
            }

            .wheel-container {
                width: min(50vh, 70vw);
                height: min(50vh, 70vw);
            }

            .instructions {
                max-height: 60vh;
            }
        }

        @media (max-width: 480px) {
            .main-title {
                font-size: 2rem;
                top: 40px;
            }

            .daily-result-section {
                width: 320px;
                bottom: 10px;
                left: 10px;
            }

            .daily-result-title {
                font-size: 1.3rem;
            }

            .daily-result-content {
                font-size: 1.4rem;
            }

            .navbar {
                top: 10px;
                right: 15px;
                gap: 4px;
                padding: 4px;
            }

            .nav-link {
                font-size: 0.8rem;
                padding: 10px 14px;
            }

            .navbar {
                top: 5px;
                right: 10px;
                gap: 8px;
            }

            .nav-link {
                font-size: 0.8rem;
                padding: 8px 12px;
            }

            .player-dock {
                width: 280px;
                left: -280px;
            }

            .leaderboard-dock {
                width: 280px;
                left: -280px;
                height: 40vh;
            }

            .players-toggle {
                right: -45px;
                padding: 10px 12px 10px 8px;
                font-size: 0.8rem;
            }

            .leaderboard-toggle {
                right: -45px;
                padding: 10px 12px 10px 8px;
                font-size: 0.8rem;
            }

            .player-card {
                padding: 12px;
            }

            .player-avatar {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }

            .spin-button {
                width: 80px;
                height: 80px;
                font-size: 0.9rem;
                bottom: -60px;
            }

            .result-content {
                font-size: 1.8rem;
            }

            .result-title {
                font-size: 1.5rem;
            }

            .music-section {
                bottom: 15px;
                right: 15px;
                width: 280px;
            }

            .music-title {
                font-size: 0.9rem;
            }

            .track-name {
                font-size: 0.8rem;
            }

            .track-artist {
                font-size: 0.7rem;
            }
        }

        /* Rectangular music player styling */
        .diagonal-music {
            transform: none;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.6),
                0 0 20px rgba(0, 255, 255, 0.3);
            transition: all 0.3s cubic-bezier(.4,0,.2,1);
        }

        .diagonal-music:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 12px 40px rgba(0, 0, 0, 0.7),
                0 0 30px rgba(0, 255, 255, 0.5);
        }
    </style>
</head>

<body>
    <div class="cyber-grid"></div>
    <div class="floating-particles" id="particles"></div>

    <!-- Main Title - Back at the top center with amazing animation -->
    <h1 class="main-title">SPIN THE SLICE</h1>

    <!-- Clean floating navigation -->
    <nav class="navbar">
        <div class="navbar-nav" id="navbarNav">
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('players')">
                    <i class="fas fa-users"></i> Players
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('leaderboard')">
                    <i class="fas fa-trophy"></i> Leaderboard
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showSection('instructions')">
                    <i class="fas fa-book"></i> How to Play
                </a>
            </div>
        </div>
        <button class="navbar-toggle" onclick="toggleMobileNav()">
            <i class="fas fa-bars"></i>
        </button>
    </nav>

    <div class="main-container">
        <!-- Header section with title and game -->
        <section class="header-section">
            <div class="game-area"></div>
            <div class="wheel-container">

                <div class="wheel-frame"></div>
                <div class="pointer"></div>
                <canvas id="pizzaWheel"></canvas>
                <div class="cheese-pull" id="cheesePull"></div>
                <button class="spin-button" id="spinButton">
                    <i class="fas fa-play"></i>
                    SPIN
                </button>
            </div>
    </div>

    <div class="scroll-indicator"
        onclick="document.querySelector('.daily-result-section').scrollIntoView({behavior: 'smooth'})">
        <i class="fas fa-chevron-down"></i>
    </div>
    </section>

    <!-- Daily result section -->
    <section class="daily-result-section">
        <div class="daily-result">
            <div class="daily-result-title">SLICE OF THE DAY</div>
            <div class="daily-result-content">Spin the wheel to find out!</div>
            <div class="daily-result-winners"></div>
        </div>
        <div class="footer-tagline">
            🍕 Predict the Slice. Own the Bite.
        </div>
    </section>
    </div>

    <!-- How to Play - moved to right side -->
    <div class="instructions">
        <h3><i class="fas fa-book"></i> How to Play</h3>
        <ul>
            <li><strong>Type your name</strong> so we know who's playing!</li>
            <li><strong>Pick a pizza</strong> - Choose the one you think the wheel will land on, or press 🎲 for a
                surprise.</li>
            <li><strong>Swipe the wheel</strong> - Use your finger (or mouse) to swipe and spin the pizza wheel.</li>
            <li><strong>See the result</strong> - The slice it lands on is the Slice of the Day.</li>
            <li><strong>Did you guess right?</strong> - If yes, you win! Take a selfie and get crowned the <strong>Slice
                    Whisperer</strong> with confetti and your winning slice.</li>
        </ul>
    </div>

    <!-- Player dock -->
    <div class="player-dock" id="playerDock">
        <div class="players-toggle" id="playersToggle">
            <i class="fas fa-users"></i>
            <span>👥</span>
        </div>
        <div class="players-panel" id="playersPanel">
            <div class="players-grid" id="playersGrid">
                <!-- Player cards will be generated here -->
            </div>
        </div>
    </div>

    <!-- Leaderboard -->
    <div class="leaderboard-dock" id="leaderboardDock">
        <div class="leaderboard-toggle" id="leaderboardToggle">
            <i class="fas fa-trophy"></i>
            <span>🏆</span>
        </div>
        <div class="leaderboard-panel" id="leaderboardPanel">
            <div class="leaderboard-header">
                <h3>SLICE WHISPERER LEADERBOARD</h3>
                <div class="leaderboard-stats">
                    <span id="totalWins">0</span> Wins •
                    <span id="totalPlayers">0</span> Players
                </div>
            </div>
            <div class="leaderboard-grid" id="leaderboardGrid">
                <!-- Leaderboard entries will be generated here -->
            </div>
        </div>
    </div>

    <!-- Modals and overlays -->
    <div class="overlay" id="overlay"></div>
    <div class="result-popup" id="resultPopup">
        <button class="close-popup" id="closePopup">
            <i class="fas fa-times"></i>
        </button>
        <h2 class="result-title">SLICE OF THE DAY</h2>
        <div class="result-content" id="resultContent">Waiting for spin...</div>
        <button class="celebration-button" id="celebrationButton" style="display: none;">
            <i class="fas fa-crown"></i> Become Slice Whisperer → Take Selfie
        </button>
    </div>

    <div class="camera-modal" id="cameraModal">
        <div class="camera-content">
            <h2 class="camera-title">📸 Slice Whisperer Selfie</h2>
            <video id="videoElement" autoplay playsinline></video>
            <img id="capturedImage"
                style="display: none; max-width: 100%; border-radius: 10px; margin: 20px 0; border: 2px solid var(--neon-green);">
            <div class="camera-controls" id="camera-controls">
                <button class="camera-button capture-button" id="captureButton">
                    <i class="fas fa-camera"></i> Capture
                </button>
            </div>
            <div class="share-options" id="shareOptions" style="display: none;">
                <button class="camera-button" onclick="downloadImage()">
                    <i class="fas fa-download"></i> Download
                </button>
                <button class="camera-button leaderboard-button" id="viewLeaderboard">
                    <i class="fas fa-trophy"></i> Check out your photo on the leaderboard!
                </button>
            </div>
        </div>
    </div>

    <canvas class="confetti-canvas" id="confettiCanvas"></canvas>

    <!-- Music Player Section -->
    <section class="music-section">
        <div class="music-player-container diagonal-music">
            <h2 class="music-title">🎵 Beckerbros Beats 🎵</h2>
            <div class="music-grid" id="musicGrid">
                <!-- Music cards will be generated here -->
            </div>
        </div>
    </section>

    <script>
        // Official pizza menu (excluding desserts)
        const officialPizzas = [
            "BBQ Pie", "Breakfast Chile", "Buffalo Chicken",
            "Cheese Pie", "Chicken Alfredo", "Fall Pizza", "Gravy Pizza", "Chile Pork",
            "Hawaiian", "Meat Lovers", "Pep Pie", "Pesto Prosciutto", "Pesto Pizza",
            "Prosciutto Pear", "Sausage", "Seasonal Pizza", "Spinach Artichoke",
            "Supreme", "Sweet & Spicy"
        ];

        // Create confetti animation
        function createCyberConfetti() {
            const canvas = document.getElementById('confettiCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const particles = [];
            const colors = ['#00ffff', '#ff0080', '#39ff14', '#8a2be2', '#ff6600'];
            
            // Create particles
            for (let i = 0; i < 150; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    vx: Math.random() * 6 - 3,
                    vy: Math.random() * 3 + 2,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 6 + 2,
                    angle: Math.random() * 360,
                    angleSpeed: Math.random() * 10 - 5
                });
            }
            
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach((particle, index) => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.vy += 0.1; // gravity
                    particle.angle += particle.angleSpeed;
                    
                    // Draw particle
                    ctx.save();
                    ctx.translate(particle.x, particle.y);
                    ctx.rotate(particle.angle * Math.PI / 180);
                    ctx.fillStyle = particle.color;
                    ctx.shadowColor = particle.color;
                    ctx.shadowBlur = 10;
                    ctx.fillRect(-particle.size/2, -particle.size/2, particle.size, particle.size);
                    ctx.restore();
                    
                    // Remove particles that fall off screen
                    if (particle.y > canvas.height) {
                        particles.splice(index, 1);
                    }
                });
                
                if (particles.length > 0) {
                    requestAnimationFrame(animate);
                } else {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
            }
            
            animate();
        }

        // Play celebration song
        function playCelebrationSong() {
            if (!globalAudioContext) {
                initAudioContext();
            }
            
            // Create a fun victory melody similar to YMCA/champion songs
            const notes = [
                { freq: 523, duration: 0.2 }, // C
                { freq: 523, duration: 0.2 }, // C
                { freq: 587, duration: 0.2 }, // D
                { freq: 659, duration: 0.4 }, // E
                { freq: 659, duration: 0.2 }, // E
                { freq: 587, duration: 0.2 }, // D
                { freq: 523, duration: 0.2 }, // C
                { freq: 784, duration: 0.6 }, // G
                { freq: 698, duration: 0.2 }, // F
                { freq: 659, duration: 0.2 }, // E
                { freq: 587, duration: 0.2 }, // D
                { freq: 784, duration: 0.8 }, // G
            ];
            
            let time = globalAudioContext.currentTime;
            
            notes.forEach((note, index) => {
                const oscillator = globalAudioContext.createOscillator();
                const gainNode = globalAudioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(masterGainNode);
                
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(note.freq, time);
                
                gainNode.gain.setValueAtTime(0, time);
                gainNode.gain.linearRampToValueAtTime(0.2, time + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, time + note.duration);
                
                oscillator.start(time);
                oscillator.stop(time + note.duration);
                
                time += note.duration;
            });
            
            // Add some drum beats
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    playArcadeSound(100, 0.1); // Bass drum
                    setTimeout(() => playArcadeSound(200, 0.05), 150); // Snare
                }, i * 300);
            }
        }

        // Leaderboard storage key
        const LEADERBOARD_STORAGE_KEY = 'spinTheSlice_leaderboard';

        // Initialize leaderboard
        function initializeLeaderboard() {
            let leaderboard = JSON.parse(localStorage.getItem(LEADERBOARD_STORAGE_KEY)) || [];
            updateLeaderboardDisplay(leaderboard);
            return leaderboard;
        }

        // Update leaderboard display
        function updateLeaderboardDisplay(leaderboard) {
            const leaderboardGrid = document.getElementById('leaderboardGrid');
            const totalWins = document.getElementById('totalWins');
            const totalPlayers = document.getElementById('totalPlayers');

            // Sort by wins (descending)
            leaderboard.sort((a, b) => b.wins - a.wins);

            // Update stats
            const totalWinCount = leaderboard.reduce((sum, player) => sum + player.wins, 0);
            totalWins.textContent = totalWinCount;
            totalPlayers.textContent = leaderboard.length;

            // Clear and rebuild grid
            leaderboardGrid.innerHTML = '';
            leaderboard.forEach((player, index) => {
                const entry = document.createElement('div');
                entry.className = 'leaderboard-entry';
                entry.innerHTML = `
                    <div class="leaderboard-rank">#${index + 1}</div>
                    <div class="leaderboard-avatar">
                        <img src="${player.avatar}" alt="${player.name}">
                    </div>
                    <div class="leaderboard-name">${player.name}</div>
                    <div class="leaderboard-wins">
                        <i class="fas fa-crown"></i> ${player.wins}
                    </div>
                `;
                leaderboardGrid.appendChild(entry);
            });
        }

        // Add win to player
        function addWinToPlayer(playerName, avatarDataUrl) {
            let leaderboard = JSON.parse(localStorage.getItem(LEADERBOARD_STORAGE_KEY)) || [];
            const playerIndex = leaderboard.findIndex(p => p.name === playerName);

            if (playerIndex >= 0) {
                // Player exists, increment wins
                leaderboard[playerIndex].wins += 1;
            } else {
                // New player
                leaderboard.push({
                    name: playerName,
                    wins: 1,
                    avatar: avatarDataUrl
                });
            }

            // Save and update display
            localStorage.setItem(LEADERBOARD_STORAGE_KEY, JSON.stringify(leaderboard));
            updateLeaderboardDisplay(leaderboard);
        }

        // Bonus toppings for Cheese and Pep Pie - RESTRICTED TO MEATS/PINEAPPLE
        const bonusToppings = [
            "Pepperoni", "Mushrooms", "Onions", "Sausage", "Bacon", "Extra Cheese",
            "Black Olives", "Green Peppers", "Pineapple", "Jalapeños", "Sun-dried Tomatoes",
            "Feta Cheese", "Prosciutto", "Artichokes"
        ];

        // Meats list for Gravy Pizza logic
        const meatToppings = ["Pepperoni", "Sausage", "Bacon", "Ham", "Chicken", "Beef"];

        let players = [];
        let wheelSpinning = false;
        let pizzaWheelCtx = null;
        let wheelRotation = 0;
        let spinVelocity = 0;
        let spinDecay = 0.98;
        let winningSlice = null;
        let winningSliceWithTopping = null;
        let stream = null;
        let capturedImageData = null;
        let capturedImageBlob = null;

        // Wheel spin logic (once per day)
        const SPIN_STORAGE_KEY = 'spinTheSlice_lastSpinDate';
        const TODAY = new Date().toISOString().split('T')[0];

        // Initialize the app with performance optimizations
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize audio context for better performance
            initAudioContext();

            createFloatingParticles();
            createPlayerCards();
            initializeWheel();
            setupEventListeners();
            resizeWheel();
            loadAndDisplayDailyResult();
            initializeLeaderboard();
            setupScrollOptimization();
            setupMusicPlayer();

            // Setup dock toggles
            const leaderboardToggle = document.getElementById('leaderboardToggle');
            const leaderboardDock = document.getElementById('leaderboardDock');
            const playersToggle = document.getElementById('playersToggle');
            const playerDock = document.getElementById('playerDock');

            // Leaderboard toggle
            if (leaderboardToggle && leaderboardDock) {
                leaderboardToggle.addEventListener('click', function () {
                    console.log('Leaderboard toggle clicked');
                    leaderboardDock.classList.toggle('expanded');
                    console.log('Leaderboard expanded:', leaderboardDock.classList.contains('expanded'));
                    playArcadeSound(660, 0.1);
                });
            }

            // Players toggle
            if (playersToggle && playerDock) {
                playersToggle.addEventListener('click', function () {
                    console.log('Players toggle clicked');
                    playerDock.classList.toggle('expanded');
                    console.log('Players expanded:', playerDock.classList.contains('expanded'));
                    playArcadeSound(660, 0.1);
                });
            }

            // Start wheel animation loop with performance optimization
            let wheelAnimationFrame;
            let lastDrawTime = 0;
            const WHEEL_FPS = 30; // Limit to 30 FPS for better performance
            const frameInterval = 1000 / WHEEL_FPS;
            
            function animateWheel(currentTime) {
                if (currentTime - lastDrawTime >= frameInterval) {
                    if (!wheelSpinning) {
                        drawWheel();
                    }
                    lastDrawTime = currentTime;
                }
                wheelAnimationFrame = requestAnimationFrame(animateWheel);
            }
            
            // Only animate when the wheel is visible
            const wheelObserver = new IntersectionObserver(
                (entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            if (!wheelAnimationFrame) {
                                animateWheel(0);
                            }
                        } else {
                            if (wheelAnimationFrame) {
                                cancelAnimationFrame(wheelAnimationFrame);
                                wheelAnimationFrame = null;
                            }
                        }
                    });
                },
                { threshold: 0.1 }
            );
            
            const wheelCanvas = document.getElementById('pizzaWheel');
            if (wheelCanvas) {
                wheelObserver.observe(wheelCanvas);
            }
        });

        function createFloatingParticles() {
            const particlesContainer = document.getElementById('particles');
            // Increased particle count back for better cyberpunk aesthetics
            for (let i = 0; i < 60; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                // Start particles at different heights for continuous effect
                particle.style.top = Math.random() * 150 + 'vh';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
            
            // Create a continuous stream by adding new particles periodically
            setInterval(() => {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = '100vh';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
                
                // Remove old particles to prevent memory leaks
                const allParticles = particlesContainer.querySelectorAll('.particle');
                if (allParticles.length > 80) {
                    particlesContainer.removeChild(allParticles[0]);
                }
            }, 500); // Add new particle every 500ms
        }

        // Scroll optimization with debouncing
        function setupScrollOptimization() {
            let scrollTimeout;
            const playersPanels = document.querySelectorAll('.players-panel, .leaderboard-panel');
            
            playersPanels.forEach(panel => {
                panel.addEventListener('scroll', function() {
                    // Add scrolling class immediately
                    if (!panel.classList.contains('is-scrolling')) {
                        panel.classList.add('is-scrolling');
                    }
                    
                    // Clear existing timeout
                    clearTimeout(scrollTimeout);
                    
                    // Remove scrolling class after scroll ends
                    scrollTimeout = setTimeout(() => {
                        panel.classList.remove('is-scrolling');
                    }, 150);
                }, { passive: true });
            });

            // Optimize select dropdowns
            const selects = document.querySelectorAll('.prediction-select');
            selects.forEach(select => {
                select.addEventListener('focus', function() {
                    this.style.transition = 'none';
                });
                select.addEventListener('blur', function() {
                    this.style.transition = '';
                });
            });
        }

        function createPlayerCards() {
            const playersGrid = document.getElementById('playersGrid');
            playersGrid.innerHTML = '';
            // Create 10 player cards with optimized rendering
            const fragment = document.createDocumentFragment();

            for (let i = 1; i <= 10; i++) {
                const playerCard = document.createElement('div');
                playerCard.className = 'player-card';
                playerCard.innerHTML = `
                    <div class="player-header">
                        <div class="player-avatar">${i}</div>
                        <input type="text" class="player-name-input" placeholder="Enter name..." data-player="${i}">
                    </div>
                    <div class="prediction-row">
                        <select class="prediction-select" data-player="${i}">
                            <option value="">🍕 Select pizza...</option>
                            ${officialPizzas.map(pizza => `<option value="${pizza}">${pizza}</option>`).join('')}
                        </select>
                        <button class="random-dice" data-player="${i}">🎲</button>
                    </div>
                `;
                fragment.appendChild(playerCard);
            }

            playersGrid.appendChild(fragment);

            // Add event listeners to dice buttons with optimized audio
            document.querySelectorAll('.random-dice').forEach(btn => {
                btn.addEventListener('click', function () {
                    const playerNum = this.dataset.player;
                    const select = document.querySelector(`.prediction-select[data-player="${playerNum}"]`);
                    const randomIndex = Math.floor(Math.random() * officialPizzas.length);
                    select.value = officialPizzas[randomIndex];
                    // Enhanced visual feedback with immediate sound
                    this.style.transform = 'rotate(720deg) scale(1.3)';
                    this.style.boxShadow = '0 0 30px rgba(0, 255, 255, 1)';
                    playArcadeSound(880, 0.1);
                    setTimeout(() => {
                        this.style.transform = '';
                        this.style.boxShadow = '';
                    }, 500);
                });
            });
        }

        function initializeWheel() {
            const canvas = document.getElementById('pizzaWheel');
            pizzaWheelCtx = canvas.getContext('2d');
            resizeWheel();
            drawWheel();
        }

        function resizeWheel() {
            const canvas = document.getElementById('pizzaWheel');
            const container = canvas.parentElement;
            const size = Math.min(container.offsetWidth, container.offsetHeight);
            canvas.width = size;
            canvas.height = size;
            if (pizzaWheelCtx) drawWheel();
        }

        function drawWheel() {
            const canvas = document.getElementById('pizzaWheel');
            const ctx = pizzaWheelCtx;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 40;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const sliceCount = officialPizzas.length;
            const sliceAngle = (2 * Math.PI) / sliceCount;

            // Draw pizza base
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius + 30, 0, 2 * Math.PI);
            const crustGradient = ctx.createRadialGradient(centerX, centerY, radius - 20, centerX, centerY, radius + 30);
            crustGradient.addColorStop(0, '#d4a574');
            crustGradient.addColorStop(0.8, '#b8956a');
            crustGradient.addColorStop(1, '#9d7f57');
            ctx.fillStyle = crustGradient;
            ctx.fill();

            // Draw slices with realistic pizza appearance
            for (let i = 0; i < sliceCount; i++) {
                const startAngle = i * sliceAngle + wheelRotation;
                const endAngle = (i + 1) * sliceAngle + wheelRotation;
                const midAngle = startAngle + sliceAngle / 2;

                // Draw cheese base
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                const cheeseGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
                cheeseGradient.addColorStop(0, '#fff8dc');
                cheeseGradient.addColorStop(0.6, '#f5deb3');
                cheeseGradient.addColorStop(1, '#daa520');
                ctx.fillStyle = cheeseGradient;
                ctx.fill();

                // Check if this slice is "Gravy Pizza" and adjust sauce color
                const isGravySlice = officialPizzas[i] === "Gravy Pizza";
                const sauceColor1 = isGravySlice ? '#8B4513' : '#c41e3a';
                const sauceColor2 = isGravySlice ? '#5C3317' : '#8b0000';

                // Draw sauce layer with animated glow like SPIN THE SLICE
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius * 0.9, startAngle, endAngle);
                ctx.closePath();
                const sauceGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius * 0.9);
                sauceGradient.addColorStop(0, sauceColor1);
                sauceGradient.addColorStop(1, sauceColor2);
                ctx.fillStyle = sauceGradient;

                // Enhanced bright animated glow effect like the green text
                const time = Date.now() * 0.005 + i * 0.3;
                const glowIntensity = 25 + Math.sin(time) * 15;
                const pulseAlpha = 0.85 + Math.sin(time * 1.5) * 0.15;
                const secondaryPulse = 0.7 + Math.sin(time * 2) * 0.3;

                // Main glow layer
                ctx.globalAlpha = pulseAlpha;
                ctx.shadowColor = isGravySlice ? '#8B4513' : '#ff4444';
                ctx.shadowBlur = glowIntensity;
                ctx.fill();

                // Secondary bright glow layer
                ctx.shadowColor = isGravySlice ? '#A0522D' : '#ff6666';
                ctx.shadowBlur = glowIntensity * 0.7;
                ctx.globalAlpha = pulseAlpha * 0.8;
                ctx.fill();

                // Third ultra-bright glow layer for maximum effect
                ctx.shadowColor = isGravySlice ? '#CD853F' : '#ff8888';
                ctx.shadowBlur = glowIntensity * 0.4;
                ctx.globalAlpha = secondaryPulse * 0.6;
                ctx.fill();

                ctx.globalAlpha = 1;
                ctx.shadowBlur = 0;

                // Draw neon slice separator
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(centerX + Math.cos(startAngle) * (radius + 30),
                    centerY + Math.sin(startAngle) * (radius + 30));
                ctx.strokeStyle = `rgba(0, 255, 255, 0.8)`;
                ctx.lineWidth = 2;
                ctx.shadowColor = '#00ffff';
                ctx.shadowBlur = 10;
                ctx.stroke();
                ctx.shadowBlur = 0;

                // Draw pizza name
                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(midAngle);
                ctx.textAlign = 'center';
                const pizzaName = officialPizzas[i];
                let fontSize = Math.max(10, canvas.width / 35);
                let textWidth;
                do {
                    ctx.font = `bold ${fontSize}px Orbitron`;
                    textWidth = ctx.measureText(pizzaName).width;
                    if (textWidth > radius * 1.0) {
                        fontSize -= 0.5;
                    }
                } while (textWidth > radius * 1.0 && fontSize > 8);

                ctx.strokeStyle = 'rgba(0, 0, 0, 0.9)';
                ctx.lineWidth = Math.max(3, fontSize / 3);
                ctx.strokeText(pizzaName, radius * 0.65, 0);

                // Bright neon green glow for pizza text like SPIN THE SLICE
                const textTime = Date.now() * 0.005 + i * 0.3; // Offset each slice
                const textGlowIntensity = 18 + Math.sin(textTime) * 10;
                const pulseIntensity = 0.8 + Math.sin(textTime * 1.5) * 0.2;

                ctx.fillStyle = '#39ff14';
                ctx.shadowColor = '#39ff14';
                ctx.shadowBlur = textGlowIntensity;
                ctx.globalAlpha = pulseIntensity;
                ctx.fillText(pizzaName, radius * 0.65, 0);

                // Add extra bright glow layer
                ctx.shadowColor = '#88ff44';
                ctx.shadowBlur = textGlowIntensity * 0.7;
                ctx.globalAlpha = pulseIntensity * 0.6;
                ctx.fillText(pizzaName, radius * 0.65, 0);

                ctx.globalAlpha = 1;
                ctx.restore();
            }

            // Draw center hub with pulsing effect
            const time = Date.now() * 0.005;
            const pulseSize = 35 + Math.sin(time) * 5;
            ctx.beginPath();
            ctx.arc(centerX, centerY, pulseSize, 0, 2 * Math.PI);
            const centerGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, pulseSize);
            centerGradient.addColorStop(0, '#ff0080');
            centerGradient.addColorStop(0.5, '#8a2be2');
            centerGradient.addColorStop(1, '#00ffff');
            ctx.fillStyle = centerGradient;
            ctx.fill();
            ctx.strokeStyle = '#00ffff';
            ctx.lineWidth = 3;
            ctx.shadowColor = '#00ffff';
            ctx.shadowBlur = 15;
            ctx.stroke();
            ctx.shadowBlur = 0;
        }

        // Optimized audio system with shared context and better performance
        let globalAudioContext = null;
        let masterGainNode = null;

        function initAudioContext() {
            if (!globalAudioContext) {
                try {
                    globalAudioContext = new (window.AudioContext || window.webkitAudioContext)();
                    // Create a master gain node for better audio control
                    masterGainNode = globalAudioContext.createGain();
                    masterGainNode.gain.value = 0.3; // Reduced master volume to prevent audio distortion
                    masterGainNode.connect(globalAudioContext.destination);

                    // Pre-create a buffer to reduce latency
                    const buffer = globalAudioContext.createBuffer(1, 1, globalAudioContext.sampleRate);
                    const data = buffer.getChannelData(0);
                    data[0] = 0;
                } catch (e) {
                    console.log("Audio not supported");
                }
            }
        }

        function playArcadeSound(frequency, duration) {
            if (!globalAudioContext) return;

            // Use a more efficient approach with immediate scheduling
            try {
                // Resume audio context if suspended (common in modern browsers)
                if (globalAudioContext.state === 'suspended') {
                    globalAudioContext.resume();
                }

                const oscillator = globalAudioContext.createOscillator();
                const gainNode = globalAudioContext.createGain();

                // Connect through master gain for consistent volume control
                oscillator.connect(gainNode);
                gainNode.connect(masterGainNode);

                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(frequency, globalAudioContext.currentTime);

                // Set initial gain
                gainNode.gain.setValueAtTime(0.1, globalAudioContext.currentTime);

                // Smoothly decay the sound
                gainNode.gain.exponentialRampToValueAtTime(0.001, globalAudioContext.currentTime + duration);

                oscillator.start();
                oscillator.stop(globalAudioContext.currentTime + duration);

                // Clean up references after sound completes
                setTimeout(() => {
                    try {
                        oscillator.disconnect();
                        gainNode.disconnect();
                    } catch (e) {
                        // Ignore errors during cleanup
                    }
                }, duration * 1000);
            } catch (e) {
                console.log("Error playing sound:", e);
            }
        }

        function setupEventListeners() {
            const canvas = document.getElementById('pizzaWheel');
            const resultPopup = document.getElementById('resultPopup');
            const closePopup = document.getElementById('closePopup');
            const overlay = document.getElementById('overlay');
            const celebrationButton = document.getElementById('celebrationButton');
            const cameraModal = document.getElementById('cameraModal');
            const captureButton = document.getElementById('captureButton');
            const spinButton = document.getElementById('spinButton');
            const viewLeaderboard = document.getElementById('viewLeaderboard');

            // Check before spinning - removed daily limit for testing
            spinButton.addEventListener('click', function () {
                if (!wheelSpinning) {
                    spinVelocity = 20 + Math.random() * 15;
                    if (Math.random() > 0.5) spinVelocity = -spinVelocity;
                    startSpinAnimation();
                    playArcadeSound(800, 0.2);
                }
            });

            // Touch events for swipe spinning - removed daily limit
            let touchStartY = 0;
            canvas.addEventListener('touchstart', function (e) {
                if (!wheelSpinning) {
                    touchStartY = e.touches[0].clientY;
                    e.preventDefault();
                }
            });
            canvas.addEventListener('touchend', function (e) {
                if (!wheelSpinning) {
                    const touchEndY = e.changedTouches[0].clientY;
                    const deltaY = touchStartY - touchEndY;
                    if (Math.abs(deltaY) > 25) {
                        spinVelocity = Math.min(Math.abs(deltaY) / 5, 35);
                        if (deltaY < 0) spinVelocity = -spinVelocity;
                        startSpinAnimation();
                    }
                }
                e.preventDefault();
            });

            // Mouse events for desktop - removed daily limit
            let mouseStartY = 0;
            let isMouseDown = false;
            canvas.addEventListener('mousedown', function (e) {
                if (!wheelSpinning) {
                    mouseStartY = e.clientY;
                    isMouseDown = true;
                    canvas.style.cursor = 'grabbing';
                }
            });
            canvas.addEventListener('mouseup', function (e) {
                if (isMouseDown && !wheelSpinning) {
                    const deltaY = mouseStartY - e.clientY;
                    if (Math.abs(deltaY) > 20) {
                        spinVelocity = Math.min(Math.abs(deltaY) / 3, 30);
                        if (deltaY < 0) spinVelocity = -spinVelocity;
                        startSpinAnimation();
                    }
                }
                isMouseDown = false;
                canvas.style.cursor = 'grab';
            });
            canvas.addEventListener('mouseleave', function () {
                isMouseDown = false;
                canvas.style.cursor = 'grab';
            });

            // Popup controls
            closePopup.addEventListener('click', function () {
                resultPopup.classList.remove('active');
                overlay.classList.remove('active');
            });
            overlay.addEventListener('click', function () {
                resultPopup.classList.remove('active');
                overlay.classList.remove('active');
            });

            // Celebration button
            celebrationButton.addEventListener('click', function () {
                cameraModal.style.display = 'flex';
                startCamera();
                document.getElementById('shareOptions').style.display = 'none';
                document.getElementById('captureButton').style.display = 'flex';
                document.getElementById('capturedImage').style.display = 'none';
                document.getElementById('videoElement').style.display = 'block';
            });

            // Camera controls
            captureButton.addEventListener('click', function () {
                captureImage();
            });

            // View leaderboard button
            if (viewLeaderboard) {
                viewLeaderboard.addEventListener('click', function () {
                    cameraModal.style.display = 'none';
                    stopCamera();
                    // Scroll to leaderboard and open it
                    const leaderboardDock = document.getElementById('leaderboardDock');
                    if (leaderboardDock) {
                        leaderboardDock.classList.add('expanded');
                        leaderboardDock.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                });
            }

            // Window resize
            window.addEventListener('resize', resizeWheel);
        }

        function startSpinAnimation() {
            if (wheelSpinning) return;
            wheelSpinning = true;

            // Collect player data
            players = [];
            document.querySelectorAll('.player-card').forEach((card, index) => {
                const nameInput = card.querySelector('.player-name-input');
                const select = card.querySelector('.prediction-select');
                const name = nameInput.value || `Player ${index + 1}`;
                const prediction = select.value;
                if (prediction) {
                    players.push({
                        name: name,
                        prediction: prediction
                    });
                }
            });

            if (players.length === 0) {
                alert('At least one player must make a prediction!');
                wheelSpinning = false;
                return;
            }

            function animate() {
                if (Math.abs(spinVelocity) > 0.1) {
                    wheelRotation += spinVelocity * 0.05;
                    spinVelocity *= spinDecay;
                    drawWheel();
                    requestAnimationFrame(animate);
                } else {
                    finishSpin();
                }
            }
            animate();
        }

        function finishSpin() {
            wheelSpinning = false;

            // Determine winning slice with precise calculation
            const sliceCount = officialPizzas.length;
            const sliceAngle = (2 * Math.PI) / sliceCount;

            // Normalize rotation to 0-2π range
            let normalizedRotation = wheelRotation % (2 * Math.PI);
            
            // Ensure positive value
            while (normalizedRotation < 0) {
                normalizedRotation += 2 * Math.PI;
            }

            // The pointer is at the top (12 o'clock position)
            // We need to find which slice is at the top position
            // Slices are drawn starting from 0 radians (3 o'clock) and going counter-clockwise
            
            // Calculate how many slice angles we need to rotate back from the top position
            // The top is at 3π/2 radians (or -π/2) in standard coordinates
            const pointerPosition = 3 * Math.PI / 2; // Top position in radians
            
            // Calculate which slice index is at the top
            // We subtract the current rotation from the pointer position to get the original slice position
            let sliceAtTop = (pointerPosition - normalizedRotation) % (2 * Math.PI);
            
            // Ensure positive value
            while (sliceAtTop < 0) {
                sliceAtTop += 2 * Math.PI;
            }
            
            // Find which slice this angle corresponds to
            let winningIndex = Math.floor(sliceAtTop / sliceAngle);
            
            // Ensure the index is within valid bounds
            winningIndex = winningIndex % sliceCount;
            
            winningSlice = officialPizzas[winningIndex];

            // Debug logging
            console.log('=== SPIN RESULT ===');
            console.log('Wheel rotation:', wheelRotation);
            console.log('Normalized rotation:', normalizedRotation);
            console.log('Slice at top angle:', sliceAtTop);
            console.log('Slice angle size:', sliceAngle);
            console.log('Winning index:', winningIndex);
            console.log('Winning slice:', winningSlice);

            // Trigger cheese pull animation
            const cheesePull = document.getElementById('cheesePull');
            cheesePull.classList.add('active');
            setTimeout(() => cheesePull.classList.remove('active'), 2000);

            // Apply bonus topping logic
            winningSliceWithTopping = winningSlice;
            if (winningSlice === "Cheese Pie" || winningSlice === "Pep Pie") {
                const randomTopping = bonusToppings[Math.floor(Math.random() * bonusToppings.length)];
                winningSliceWithTopping = `${winningSlice} + ${randomTopping}`;
            }
            if (winningSlice === "Gravy Pizza") {
                const randomMeat = meatToppings[Math.floor(Math.random() * meatToppings.length)];
                winningSliceWithTopping = `${winningSlice} + ${randomMeat}`;
            }

            // Play result sound
            playArcadeSound(523, 0.3);
            setTimeout(() => playArcadeSound(659, 0.3), 300);
            setTimeout(() => playArcadeSound(784, 0.5), 600);

            // Ensure winning slice is valid
            if (!winningSlice || !winningSliceWithTopping) {
                console.error('Invalid winning slice detected, using fallback');
                winningSlice = officialPizzas[0]; // Fallback to first slice
                winningSliceWithTopping = winningSlice;
            }

            // Show result popup - add a small delay to ensure DOM is ready
            setTimeout(() => {
                const resultContent = document.getElementById('resultContent');
                const celebrationButton = document.getElementById('celebrationButton');
                const resultPopup = document.getElementById('resultPopup');
                const overlay = document.getElementById('overlay');

                // Update result content
                if (resultContent) {
                    resultContent.textContent = winningSliceWithTopping;
                    console.log('Set popup content to:', winningSliceWithTopping);
                } else {
                    console.error('Result content element not found!');
                }

                // Check if any player won
                const winners = players.filter(player => player.prediction === winningSlice);
                if (winners.length > 0) {
                    if (celebrationButton) {
                        celebrationButton.style.display = 'flex';
                    }
                    createCyberConfetti();
                    // Play celebration song instead of individual notes
                    setTimeout(() => playCelebrationSong(), 500);
                } else {
                    if (celebrationButton) {
                        celebrationButton.style.display = 'none';
                    }
                }

                // Show popup - ensure both elements exist and are shown
                if (resultPopup && overlay) {
                    resultPopup.classList.add('active');
                    overlay.classList.add('active');
                    console.log('Popup shown successfully');
                } else {
                    console.error('Popup elements not found:', { resultPopup: !!resultPopup, overlay: !!overlay });
                    // Try to create alert as fallback
                    alert(`Slice of the Day: ${winningSliceWithTopping}`);
                }

                // Update the daily result
                updateAndStoreDailyResult(winningSliceWithTopping, winners);

                // Also update the daily result display immediately
                const dailyResultContent = document.querySelector('.daily-result-content');
                if (dailyResultContent) {
                    dailyResultContent.textContent = winningSliceWithTopping;
                    console.log('Updated daily result display:', winningSliceWithTopping);
                }
            }, 100); // Small delay to ensure DOM is ready
        }


        function startCamera() {
            const video = document.getElementById('videoElement');
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function (mediaStream) {
                        stream = mediaStream;
                        video.srcObject = mediaStream;
                    })
                    .catch(function (error) {
                        console.error("Camera access denied or not available", error);
                        alert("Could not access camera. Please check permissions.");
                        document.getElementById('cameraModal').style.display = 'none';
                    });
            } else {
                alert("Camera not supported in this browser.");
                document.getElementById('cameraModal').style.display = 'none';
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
        }

        function captureImage() {
            const video = document.getElementById('videoElement');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);

            stopCamera();
            video.style.display = 'none';

            // Add cyberpunk overlay
            const overlayHeight = 120;
            const gradient = ctx.createLinearGradient(0, canvas.height - overlayHeight, 0, canvas.height);
            gradient.addColorStop(0, 'rgba(10, 10, 30, 0.9)');
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0.95)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, canvas.height - overlayHeight, canvas.width, overlayHeight);

            ctx.strokeStyle = '#00ffff';
            ctx.lineWidth = 4;
            ctx.shadowColor = '#00ffff';
            ctx.shadowBlur = 10;
            ctx.strokeRect(10, canvas.height - overlayHeight + 10, canvas.width - 20, overlayHeight - 20);
            ctx.shadowBlur = 0;

            let winnerName = 'Player';
            const winners = players.filter(player => player.prediction === winningSlice);
            if (winners.length > 0) {
                winnerName = winners[0].name || winnerName;
            }

            ctx.fillStyle = '#ff0080';
            ctx.font = 'bold 28px Orbitron';
            ctx.textAlign = 'center';
            ctx.shadowColor = '#ff0080';
            ctx.shadowBlur = 15;
            ctx.fillText('🍕 SLICE WHISPERER 🍕', canvas.width / 2, canvas.height - 80);
            ctx.fillStyle = '#00ffff';
            ctx.font = 'bold 20px Orbitron';
            ctx.shadowColor = '#00ffff';
            ctx.shadowBlur = 10;
            ctx.fillText(`PREDICTED: ${winningSlice}`, canvas.width / 2, canvas.height - 50);
            ctx.fillStyle = '#39ff14';
            ctx.font = '16px Orbitron';
            ctx.shadowColor = '#39ff14';
            ctx.shadowBlur = 8;
            ctx.fillText(`PLAYER: ${winnerName}`, canvas.width / 2, canvas.height - 25);
            ctx.shadowBlur = 0;

            // Convert canvas to blob and update UI
            canvas.toBlob(function (blob) {
                capturedImageBlob = blob;
                const url = URL.createObjectURL(blob);
                const capturedImageElement = document.getElementById('capturedImage');
                capturedImageElement.src = url;
                capturedImageElement.style.display = 'block';

                // Save to leaderboard if player won
                if (winners.length > 0) {
                    addWinToPlayer(winnerName, url);
                }
            }, 'image/png');

            capturedImageData = canvas.toDataURL('image/png');
            playArcadeSound(1000, 0.1);
            document.getElementById('shareOptions').style.display = 'flex';
            document.getElementById('captureButton').style.display = 'none';
        }

        function copyCaption() {
            const caption = `I was crowned the "Slice Whisperer" after guessing the winning slice on Spin the Slice! 🍕🔥 spintheslice.com`;
            navigator.clipboard.writeText(caption).then(() => {
                alert('Caption copied to clipboard!');
                playArcadeSound(600, 0.2);
            }).catch(err => {
                console.error('Failed to copy caption: ', err);
                alert('Failed to copy caption.');
            });
        }



        function downloadImage() {
            if (capturedImageData) {
                let winnerName = 'Player';
                const winners = players.filter(player => player.prediction === winningSlice);
                if (winners.length > 0) {
                    winnerName = winners[0].name.replace(/[^a-zA-Z0-9-_]/g, '_') || winnerName;
                }
                const filename = `SliceWhisperer_${winnerName}.png`;

                const link = document.createElement('a');
                link.download = filename;
                link.href = capturedImageData;
                link.click();
                playArcadeSound(600, 0.2);
            }
        }

        // Daily result functions
        const DAILY_RESULT_STORAGE_KEY = 'spinTheSlice_dailyResult';

        function updateAndStoreDailyResult(sliceName, winners) {
            const resultData = {
                date: TODAY,
                slice: sliceName,
                winners: winners.map(w => w.name)
            };
            localStorage.setItem(DAILY_RESULT_STORAGE_KEY, JSON.stringify(resultData));
            displayDailyResult(resultData);
        }

        function loadAndDisplayDailyResult() {
            const storedData = localStorage.getItem(DAILY_RESULT_STORAGE_KEY);
            if (storedData) {
                try {
                    const resultData = JSON.parse(storedData);
                    displayDailyResult(resultData);
                } catch (e) {
                    console.error("Error parsing daily result ", e);
                }
            }
        }

        function displayDailyResult(data) {
            const titleElement = document.querySelector('.daily-result-title');
            const contentElement = document.querySelector('.daily-result-content');
            const winnersElement = document.querySelector('.daily-result-winners');

            if (titleElement && contentElement && winnersElement) {
                titleElement.textContent = `SLICE OF THE DAY (${data.date})`;
                contentElement.textContent = data.slice;
                if (data.winners && data.winners.length > 0) {
                    winnersElement.innerHTML = `<strong>🏆 Winners:</strong><br>` +
                        data.winners.map(winner => `<span class="daily-result-winner-item">${winner}</span>`).join('');
                } else {
                    winnersElement.innerHTML = `<span class="daily-result-winner-item">No winners today</span>`;
                }
            }
        }

        function shareToSocial(platform) {
            const text = `🍕⚡ I'm the SLICE WHISPERER! Correctly predicted ${winningSlice} in the cyberpunk pizza roulette! 🎮✨ #SpinTheSlice #SliceWhisperer #CyberpunkPizza`;
            const url = window.location.href;
            let shareUrl;
            switch (platform) {
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
                    break;
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(text)}`;
                    break;
                case 'instagram':
                    alert('📸 Save the image and share it on Instagram with this caption:\n' + text);
                    return;
            }
            playArcadeSound(800, 0.1);
            window.open(shareUrl, '_blank', 'width=600,height=400');
        }

        // Navigation functions
        function showSection(section) {
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');

            // Get current state of panels
            const playerDock = document.getElementById('playerDock');
            const leaderboardDock = document.getElementById('leaderboardDock');
            const instructions = document.querySelector('.instructions');

            const isPlayerOpen = playerDock.classList.contains('expanded');
            const isLeaderboardOpen = leaderboardDock.classList.contains('expanded');
            const isInstructionsOpen = instructions.classList.contains('active');

            // Hide all panels
            playerDock.classList.remove('expanded');
            leaderboardDock.classList.remove('expanded');
            instructions.classList.remove('active');

            // Toggle selected section - if already open, close it; if closed, open it
            switch (section) {
                case 'players':
                    if (isPlayerOpen) {
                        event.target.classList.remove('active');
                    } else {
                        playerDock.classList.add('expanded');
                    }
                    break;
                case 'leaderboard':
                    if (isLeaderboardOpen) {
                        event.target.classList.remove('active');
                    } else {
                        leaderboardDock.classList.add('expanded');
                    }
                    break;
                case 'instructions':
                    if (isInstructionsOpen) {
                        event.target.classList.remove('active');
                    } else {
                        instructions.classList.add('active');
                    }
                    break;
                case 'game':
                default:
                    // Game is always visible, just close other panels
                    break;
            }

            playArcadeSound(660, 0.1);
        }

        function toggleMobileNav() {
            const nav = document.getElementById('navbarNav');
            nav.classList.toggle('active');
            playArcadeSound(660, 0.1);
        }
        // Music player functionality
        function setupMusicPlayer() {
            const musicGrid = document.getElementById('musicGrid');
            
            // Debug: Log current location
            console.log('Current page URL:', window.location.href);
            console.log('Base URL:', window.location.origin + window.location.pathname);
            
            const tracks = [
                { name: "CO_CREATE", file: "BECKERBROSBEATS/CO_CREATE.mp3", artist: "Beckerbros" },
                { name: "Liberty.exe", file: "BECKERBROSBEATS/Liberty.exe.mp3", artist: "Beckerbros" },
                { name: "MECHANIZED HALO", file: "BECKERBROSBEATS/MECHANIZED HALO.mp3", artist: "Beckerbros" },
                { name: "More than just a Job", file: "BECKERBROSBEATS/More than just a Job.mp3", artist: "Beckerbros" },
                { name: "PROMPT__ _reclaim", file: "BECKERBROSBEATS/PROMPT__ _reclaim.mp3", artist: "Beckerbros" }
            ];
            
            // Debug: Test file accessibility
            tracks.forEach(track => {
                fetch(track.file, { method: 'HEAD' })
                    .then(response => {
                        console.log(`File ${track.file} status:`, response.status, response.statusText);
                    })
                    .catch(error => {
                        console.error(`File ${track.file} not accessible:`, error);
                    });
            });

            let currentAudio = null;
            let currentCard = null;

            tracks.forEach((track, index) => {
                const card = document.createElement('div');
                card.className = 'track-card';
                card.innerHTML = `
                    <div class="track-info">
                        <div class="track-icon">🎵</div>
                        <div class="track-details">
                            <div class="track-name">${track.name}</div>
                            <div class="track-artist">${track.artist}</div>
                        </div>
                    </div>
                    <div class="track-controls">
                        <button class="play-button" data-index="${index}">
                            <i class="fas fa-play"></i> Play
                        </button>
                        <div class="progress-bar">
                            <div class="progress-fill"></div>
                        </div>
                    </div>
                    <div class="visualizer">
                        ${Array(10).fill().map(() => '<div class="visualizer-bar"></div>').join('')}
                    </div>
                `;
                
                const playButton = card.querySelector('.play-button');
                const progressBar = card.querySelector('.progress-fill');
                
                playButton.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    if (currentAudio && currentCard === card) {
                        // Pause current track
                        if (currentAudio.paused) {
                            currentAudio.play().catch(error => {
                                console.error('Error playing audio:', error);
                                playButton.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
                                card.classList.remove('playing');
                            });
                            playButton.innerHTML = '<i class="fas fa-pause"></i> Pause';
                            card.classList.add('playing');
                        } else {
                            currentAudio.pause();
                            playButton.innerHTML = '<i class="fas fa-play"></i> Play';
                            card.classList.remove('playing');
                        }
                    } else {
                        // Stop previous track and properly reset its UI
                        if (currentAudio) {
                            currentAudio.pause();
                            currentAudio.currentTime = 0;
                            if (currentCard) {
                                currentCard.classList.remove('playing');
                                const prevPlayButton = currentCard.querySelector('.play-button');
                                const prevProgressBar = currentCard.querySelector('.progress-fill');
                                prevPlayButton.innerHTML = '<i class="fas fa-play"></i> Play';
                                prevProgressBar.style.width = '0%';
                                
                                // Remove all event listeners from previous audio
                                currentAudio.removeEventListener('timeupdate', arguments.callee);
                                currentAudio.removeEventListener('ended', arguments.callee);
                                currentAudio.removeEventListener('error', arguments.callee);
                                currentAudio.removeEventListener('canplay', arguments.callee);
                                currentAudio.removeEventListener('loadstart', arguments.callee);
                            }
                            currentAudio = null;
                            currentCard = null;
                        }
                        
                        // Play new track with improved error handling
                        playButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
                        
                        try {
                            currentAudio = new Audio();
                            currentCard = card;
                            
                            // Create named functions for event handlers to allow proper cleanup
                            const errorHandler = function(e) {
                                console.error('Audio loading error:', e, 'File:', track.file);
                                if (currentCard === card) { // Only update if this is still the current track
                                    playButton.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
                                    card.classList.remove('playing');
                                }
                                
                                // Try alternative path
                                console.log('Attempting to load from alternative path...');
                                const altPath = './' + track.file;
                                currentAudio.src = altPath;
                                currentAudio.load();
                            };
                            
                            const canplayHandler = function() {
                                console.log('Audio loaded successfully:', track.file);
                                if (currentCard === card) { // Only update if this is still the current track
                                    playButton.innerHTML = '<i class="fas fa-pause"></i> Pause';
                                    card.classList.add('playing');
                                }
                            };
                            
                            const loadstartHandler = function() {
                                console.log('Loading started for:', track.file);
                            };
                            
                            const timeupdateHandler = function() {
                                if (currentCard === card && currentAudio) { // Only update if this is still the current track
                                    const progress = (currentAudio.currentTime / currentAudio.duration) * 100;
                                    progressBar.style.width = progress + '%';
                                }
                            };
                            
                            const endedHandler = function() {
                                if (currentCard === card) { // Only update if this is still the current track
                                    playButton.innerHTML = '<i class="fas fa-play"></i> Play';
                                    card.classList.remove('playing');
                                    progressBar.style.width = '0%';
                                    currentAudio = null;
                                    currentCard = null;
                                }
                            };
                            
                            // Set up event handlers
                            currentAudio.addEventListener('error', errorHandler);
                            currentAudio.addEventListener('canplay', canplayHandler);
                            currentAudio.addEventListener('loadstart', loadstartHandler);
                            currentAudio.addEventListener('timeupdate', timeupdateHandler);
                            currentAudio.addEventListener('ended', endedHandler);
                            
                            // Store handlers for cleanup (attach to audio element)
                            currentAudio._handlers = {
                                error: errorHandler,
                                canplay: canplayHandler,
                                loadstart: loadstartHandler,
                                timeupdate: timeupdateHandler,
                                ended: endedHandler
                            };
                            
                            // Set source and attempt to play
                            currentAudio.src = track.file;
                            currentAudio.load();
                            
                            currentAudio.play().then(() => {
                                console.log('Playback started successfully');
                            }).catch(error => {
                                console.error('Playback failed:', error);
                                playButton.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
                                card.classList.remove('playing');
                            });
                            
                        } catch (error) {
                            console.error('Error creating audio element:', error);
                            playButton.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
                            card.classList.remove('playing');
                        }
                    }
                });
                
                musicGrid.appendChild(card);
            });
        }
    </script>
</body>

</html>